<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.4"><!-- Canonical URL --><link rel="canonical" href="https://vikassharma.me/python-context-manager/"><!-- Primary Meta Tags --><title>TIL: Python context manager | &lt;/&gt; Vikas Sharma</title><meta name="title" content="TIL: Python context manager"><meta name="description" content="While reviewing the requests library's codebase, I found myself diving into yet another rabbit hole. A couple of internet searches later, I had gained some foun..."><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://vikassharma.me/python-context-manager/"><meta property="og:title" content="TIL: Python context manager"><meta property="og:description" content="While reviewing the requests library's codebase, I found myself diving into yet another rabbit hole. A couple of internet searches later, I had gained some foun..."><meta property="og:image" content="https://vikassharma.me/opengraph.jpg"><meta property="article:published_time" content="2025-01-08T09:26:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://vikassharma.me/python-context-manager/"><meta property="twitter:title" content="TIL: Python context manager"><meta property="twitter:description" content="While reviewing the requests library's codebase, I found myself diving into yet another rabbit hole. A couple of internet searches later, I had gained some foun..."><meta property="twitter:image" content="https://vikassharma.me/opengraph.jpg"><!-- RSS Feed --><link rel="alternate" type="application/rss+xml" title="</> Vikas Sharma" href="https://vikassharma.me/rss.xml"><!-- Sitemap --><link rel="sitemap" href="/sitemap-index.xml"><!-- Google Tag Manager --><script>(function(){const GTM_ID = "GTM-WC7F9C2X";

  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',GTM_ID);
})();</script><!-- End Google Tag Manager --><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-X8FQN553XQ"></script><script>(function(){const GA_ID = "G-X8FQN553XQ";

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', GA_ID);
})();</script><style>:root{--width: 800px;--font-main: Verdana, sans-serif;--font-secondary: Verdana, sans-serif;--font-scale: 1em;--background-color: #fff;--heading-color: #222;--text-color: #444;--link-color: #3273dc;--visited-color: #8b6fcb;--code-background-color: #f2f2f2;--code-color: #222;--blockquote-color: #222}@media(prefers-color-scheme:dark){:root{--background-color: #01242e;--heading-color: #eee;--text-color: #ddd;--link-color: #8cc2dd;--visited-color: #8b6fcb}}body.dark-mode{--background-color: #01242e;--heading-color: #eee;--text-color: #ddd;--link-color: #8cc2dd;--visited-color: #8b6fcb;--code-background-color: #0d1117;--code-color: #ddd;--blockquote-color: #ccc}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}pre{padding:20px}*:not(pre)>code{font-family:monospace;padding:2px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px}blockquote{border-left:1px solid #999;color:var(--code-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}time{font-family:monospace;font-style:normal;font-size:15px}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{padding:1px 15px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}.tags{font-size:.83rem}.tag{margin-right:.25rem}.filter-title{margin-bottom:0}.remove-filter{font-size:.83rem}form{line-height:1}.item-index ul{list-style:none;padding:0;display:flex;flex-wrap:wrap;gap:.5rem}.item-index a{display:inline-block;padding:.25rem .75rem;border:1px solid var(--dim);border-radius:4px;text-decoration:none}ul.item-groups,.item-groups ul{list-style:none;padding:0;margin:0}.item-groups li{display:flex;align-items:baseline;gap:1ch;border-bottom:1px solid var(--dim)}.item-groups li:last-child{border-bottom:none}.item-groups li a{text-decoration:none}.item-groups time{color:var(--dim);font-size:.9rem;flex-shrink:0}.item-groups .title{text-decoration:underline}.preview-container{display:flex;flex-direction:column;gap:1rem;height:85vh}.pane{display:flex}.pane:first-of-type{height:40%}.pane:last-of-type{height:60%;overflow-y:auto;border:1px solid var(--dim);background:#fff}#markdown-input{width:100%;flex-grow:1;border:1px solid var(--dim);padding:1rem;font-family:monospace;font-size:16px;resize:vertical;background:#00000005}#preview-wrapper{width:100%}#preview-wrapper h1:first-child{margin-top:0}.social-links{margin-top:2rem;display:flex;gap:1rem}.social-links a{text-decoration:none;padding:.5rem 1rem;border:1px solid #ccc;border-radius:5px}.social-links a:hover{background-color:#eee}.footer[data-astro-cid-sz7xmlte]{padding:2rem 0;text-align:center}main[data-astro-cid-ivdev4kk]{flex-grow:1}body{display:flex;flex-direction:column;min-height:100vh}
.category-links[data-astro-cid-33jieqlm]{margin-top:1rem;margin-bottom:1rem;font-size:.9rem;color:var(--dim)}.category-links[data-astro-cid-33jieqlm] a[data-astro-cid-33jieqlm]{text-decoration:underline;text-decoration-style:dotted}
</style></head> <body data-astro-cid-yxt6t7ye> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WC7F9C2X" height="0" width="0" style="display:none;visibility:hidden" data-astro-cid-yxt6t7ye></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <header> <a class="title" href="/"> <h1>&lt;/&gt; Vikas Sharma</h1> </a> <nav> <p> <a href="/">Home</a> <a href="/blog">Blog</a> <a href="/about">About</a> <a href="/rss.xml">RSS</a> </p> </nav> </header> <main data-astro-cid-ivdev4kk>    <article>  <h1>TIL: Python context manager</h1> <time datetime="2025-01-08T09:26:00.000Z">08 Jan, 2025</time> <div class="category-links" data-astro-cid-33jieqlm>
categories:
<a href="/categories#sticky-notes" data-astro-cid-33jieqlm>sticky-notes</a>, <a href="/categories#til" data-astro-cid-33jieqlm>til</a></div> <hr>  <p>While reviewing the <code>requests</code> library’s codebase, I found myself diving into yet another rabbit hole. A couple of internet searches later, I had gained some foundational understanding of the concept I encountered, which I decided to capture under my <code>TIL</code> (Things I Learned Today) series.</p>
<h3 id="discovery-__enter__-and-__exit__">Discovery: <code>__enter__</code> and <code>__exit__</code></h3>
<p>During my code-reading exercise, I came across two dunder (double underscore) methods: <code>__enter__</code> and <code>__exit__</code>. These were new to me, but I quickly learned their importance in Python’s built-in <a href="https://docs.python.org/3/reference/datamodel.html#context-managers">Context Manager</a> mechanism.</p>
<h3 id="what-is-a-context-manager">What is a Context Manager?</h3>
<p>Context managers in Python are used to manage resources efficiently. They handle the setup and teardown logic required when working with resources such as files, network connections, or database cursors. The <code>with</code> statement is the idiomatic way to use context managers.</p>
<p>For example, consider file operations in Python:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'filename'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#FFAB70"> file</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#FFAB70">    file</span><span style="color:#E1E4E8">.read()</span></span></code></pre>
<p>Under the hood, the <code>with</code> statement ensures that the file object is properly allocated and released, even if an exception occurs during execution. The equivalent code using try and finally would look like this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#FFAB70">file</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'filename'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">try</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#FFAB70">    file</span><span style="color:#E1E4E8">.read()</span></span>
<span class="line"><span style="color:#F97583">finally</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#FFAB70">    file</span><span style="color:#E1E4E8">.close()</span></span></code></pre>
<p>Really amazing to see the amount of boilerplate this reduces.</p>
<h3 id="custom-context-managers">Custom Context Managers</h3>
<p>The magic behind context managers lies in the <code>__enter__</code> and <code>__exit__</code> methods. By defining these methods in a class, you can create custom context managers. Here’s an example from the requests library, specifically in the <a href="https://github.com/psf/requests/blob/23540c93cac97c763fe59e843a08fa2825aa80fd/src/requests/sessions.py#L451-L455">sessions.py</a> file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Session</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#9ECBFF">    '''</span></span>
<span class="line"><span style="color:#9ECBFF">    Omitting other sections for brevity. Refer to the link above</span></span>
<span class="line"><span style="color:#9ECBFF">    to view the complete code.</span></span>
<span class="line"><span style="color:#9ECBFF">    '''</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __enter__</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> self</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __exit__</span><span style="color:#E1E4E8">(self, exc_type, exc_value, traceback):</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.close()</span></span></code></pre>
<p>This implementation allows the Session class to be used with the <code>with</code> keyword, like so:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">with</span><span style="color:#E1E4E8"> Session() </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> session:</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> session.request(</span><span style="color:#FFAB70">method</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">method, </span><span style="color:#FFAB70">url</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">url, </span><span style="color:#F97583">**</span><span style="color:#E1E4E8">kwargs)</span></span></code></pre>
<p>In this example, the <code>__enter__</code> method initializes the context and returns the Session instance, while the <code>__exit__</code> method ensures that the session is properly closed, even if an exception occurs.</p>
<h3 id="handling-exceptions-in-__exit__">Handling exceptions in <code>__exit__</code></h3>
<p>The <code>__exit__</code> method can also handle exceptions raised within the context block. Its signature includes three arguments:</p>
<p><code>exc_type</code>: The exception type.<br>
<code>exc_value</code>: The exception instance.<br>
<code>traceback</code>: The traceback object.<br></p>
<p>If the <strong>exit</strong> method returns <code>True</code>, it suppresses the exception. Here’s an example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MyContextManager</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __enter__</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Entering context"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> self</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __exit__</span><span style="color:#E1E4E8">(self, exc_type, exc_value, traceback):</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> exc_type:</span></span>
<span class="line"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Exception caught: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">exc_value</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> True</span><span style="color:#6A737D">  # Suppress the exception</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Exiting context"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Usage</span></span>
<span class="line"><span style="color:#F97583">with</span><span style="color:#E1E4E8"> MyContextManager() </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> cm:</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Inside context"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    raise</span><span style="color:#79B8FF"> ValueError</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Something went wrong!"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Outside context"</span><span style="color:#E1E4E8">)</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zsh"><code><span class="line"><span style="color:#6A737D"># Output</span></span>
<span class="line"><span style="color:#B392F0">Entering</span><span style="color:#9ECBFF"> context</span></span>
<span class="line"><span style="color:#B392F0">Inside</span><span style="color:#9ECBFF"> context</span></span>
<span class="line"><span style="color:#B392F0">Exception</span><span style="color:#9ECBFF"> caught:</span><span style="color:#9ECBFF"> Something</span><span style="color:#9ECBFF"> went</span><span style="color:#9ECBFF"> wrong!</span></span>
<span class="line"><span style="color:#B392F0">Outside</span><span style="color:#9ECBFF"> context</span></span></code></pre>  </article>    </main>  <footer class="footer" data-astro-cid-sz7xmlte> <div class="container" data-astro-cid-sz7xmlte> <p data-astro-cid-sz7xmlte>&copy; 2026 Vikas Sharma. All rights reserved.</p> </div> </footer>  </body> </html>